# Services Environment Variables Example
# Copy this file to services.env_vars.auto.tfvars and update with your values
#
# These variables populate Nomad's Variables store for each service.
# ⚠️ WARNING: This file contains sensitive credentials - DO NOT commit to version control!

env_vars = {
  # Traefik Forward Auth - OAuth Authentication
  auth = {
    vars = {
      AUTH_HOST                      = "auth.example.com"
      COOKIE_DOMAIN                  = "example.com"
      INSECURE_COOKIE                = "true"  # Set to false for production with HTTPS
      LOG_LEVEL                      = "DEBUG"
      PROVIDERS_GOOGLE_CLIENT_ID     = "your-google-client-id.apps.googleusercontent.com"
      PROVIDERS_GOOGLE_CLIENT_SECRET = "your-google-client-secret"
      SECRET                         = "generate-random-32-char-secret"  # openssl rand -hex 32
      WHITELIST                      = "user@example.com,admin@example.com"  # Comma-separated emails
    }
  }

  # Grafana - Metrics Visualization
  grafana = {
    vars = {
      GRAFANA_URL        = "https://grafana.example.com"
      GF_PATHS_DATA      = "/var/lib/grafana"
      GRAFANA_EMAIL      = "admin@example.com"
      GRAFANA_PASSWORD   = "change-this-password"
      GF_INSTALL_PLUGINS = "grafana-piechart-panel"  # Comma-separated plugin list
    }
  }

  # InfluxDB - Time Series Database
  influxdb = {
    vars = {
      DOCKER_INFLUXDB_INIT_BUCKET   = "default"
      DOCKER_INFLUXDB_INIT_MODE     = "setup"
      DOCKER_INFLUXDB_INIT_ORG      = "home"
      DOCKER_INFLUXDB_INIT_PASSWORD = "change-this-password"
      DOCKER_INFLUXDB_INIT_USERNAME = "admin"
    }
  }

  # UniFi Network Controller
  unifi = {
    vars = {
      MONGO_DBNAME               = "unifi"
      MONGO_USER                 = "unifi"
      MONGO_PASS                 = "change-this-password"
      MONGO_INITDB_ROOT_USERNAME = "root"
      MONGO_INITDB_ROOT_PASSWORD = "change-this-root-password"
      MONGO_HOST                 = "mongo.service.consul"  # Consul service name
      MONGO_PORT                 = "27017"
      MONGO_AUTHSOURCE           = "admin"
    }
  }

  # Home Assistant - Home Automation Platform
  home-assistant = {
    vars = {
      TZ = "America/Denver"  # Timezone for automations
    }
  }

  # PostgreSQL - Relational Database
  postgres = {
    vars = {
      POSTGRES_USER     = "postgres"
      POSTGRES_PASSWORD = "change-this-password"
      POSTGRES_DB       = "postgres"
    }
  }

  # MongoDB - Document Database
  mongodb8 = {
    vars = {
      MONGO_INITDB_ROOT_USERNAME = "root"
      MONGO_INITDB_ROOT_PASSWORD = "change-this-password"
    }
  }

  # Vaultwarden - Bitwarden Server
  vaultwarden = {
    vars = {
      ADMIN_TOKEN = "generate-random-token"  # openssl rand -base64 48
      DOMAIN      = "https://vault.example.com"
    }
  }

  # n8n - Workflow Automation
  n8n = {
    vars = {
      N8N_BASIC_AUTH_ACTIVE = "true"
      N8N_BASIC_AUTH_USER   = "admin"
      N8N_BASIC_AUTH_PASSWORD = "change-this-password"
      N8N_HOST              = "n8n.example.com"
      N8N_PROTOCOL          = "https"
      WEBHOOK_URL           = "https://n8n.example.com/"
    }
  }

  # Plex Media Server
  plex = {
    vars = {
      PLEX_CLAIM = "claim-your-claim-code-from-plex-tv"  # Get from plex.tv/claim
      TZ         = "America/Denver"
    }
  }

  # Jellyfin - Media Server
  jellyfin = {
    vars = {
      TZ = "America/Denver"
    }
  }

  # Transmission - BitTorrent Client
  transmission = {
    vars = {
      USER     = "admin"
      PASS     = "change-this-password"
      TZ       = "America/Denver"
    }
  }

  # SABnzbd - Usenet Client
  sabnzbd = {
    vars = {
      TZ = "America/Denver"
    }
  }

  # Wiki.js - Documentation Platform
  wikijs = {
    vars = {
      DB_TYPE = "postgres"
      DB_HOST = "postgres.service.consul"
      DB_PORT = "5432"
      DB_USER = "wikijs"
      DB_PASS = "change-this-password"
      DB_NAME = "wikijs"
    }
  }

  # Graylog - Log Management
  graylog = {
    vars = {
      GRAYLOG_PASSWORD_SECRET = "generate-random-secret-min-16-chars"  # openssl rand -hex 32
      GRAYLOG_ROOT_PASSWORD_SHA2 = "generate-sha256-hash"  # echo -n "yourpassword" | sha256sum
      GRAYLOG_HTTP_EXTERNAL_URI = "https://graylog.example.com/"
    }
  }

  # Cloudflare Tunnel
  cloudflared = {
    vars = {
      TUNNEL_TOKEN = "your-cloudflare-tunnel-token"
    }
  }

  # MQTT Mosquitto Broker
  mosquitto = {
    vars = {
      TZ = "America/Denver"
    }
  }

  # Prometheus - Monitoring
  prometheus = {
    vars = {
      TZ = "America/Denver"
    }
  }

  # Loki - Log Aggregation
  loki = {
    vars = {
      TZ = "America/Denver"
    }
  }
}

# Security Best Practices:
# 1. Use strong, unique passwords for each service
# 2. Generate random tokens with: openssl rand -hex 32
# 3. Use Nomad Variables ACLs to restrict access
# 4. Consider using HashiCorp Vault for secrets management
# 5. Never commit this file to version control
# 6. Regularly rotate passwords and tokens
# 7. Use HTTPS/TLS for all external services

# Password Generation Commands:
# Random password: openssl rand -base64 24
# Random hex string: openssl rand -hex 32
# SHA256 hash: echo -n "password" | sha256sum | cut -d' ' -f1

# Notes:
# - Service names must match the keys in services.hcl_vars.auto.tfvars
# - Not all services require environment variables
# - Variables are stored in Nomad's Variables store at nomad/jobs/<service-name>
# - Access variables in job templates with: {{ with nomadVar "nomad/jobs/service" }}
# - TZ (timezone) should match your location for correct timestamps
